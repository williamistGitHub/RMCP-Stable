plugins {
    id 'application'
    id 'com.github.johnrengelman.shadow' version '7.1.2'
}

sourceCompatibility = JavaVersion.VERSION_1_8
targetCompatibility = JavaVersion.VERSION_1_8

mainClassName = 'org.mcphackers.mcp.main.MainCLI'
version = 'r1.1'

repositories {
    mavenCentral()
    maven { url 'https://jitpack.io' }
    maven { url 'https://maven.fabricmc.net/' }
    flatDir {
        dirs "libs"
    }
}

dependencies {
    // Required libraries
    implementation "org.ow2.asm:asm:${project.asm_version}"
    implementation "org.ow2.asm:asm-analysis:${project.asm_version}"
    implementation "org.ow2.asm:asm-commons:${project.asm_version}"
    implementation "org.ow2.asm:asm-tree:${project.asm_version}"
    implementation "org.ow2.asm:asm-util:${project.asm_version}"

    implementation "com.github.Lassebq:Fernflower:${project.fernflower_version}"
    implementation "com.github.MCPHackers:RetroDebugInjector:${project.rdi_version}"
    implementation "com.github.MCPHackers:Stitch:${project.stitch_version}"
    implementation "org.fusesource.jansi:jansi:${project.jansi_version}"
    implementation "net.fabricmc:tiny-remapper:${project.tr_version}"
    implementation "org.json:json:${project.json_version}"
    implementation "com.github.MCPHackers:DiffPatch:${project.diffpatch_version}"
    implementation "net.fabricmc:mapping-io:${project.mapping_io_version}"
}

application {
    // Redirect all execution into the testing folder
    mainClass = mainClassName
    executableDir = 'test'
    mkdir(executableDir)
}

shadowJar {
    minimize()
}

run {
    workingDir 'test'
}

runShadow {

}

task decompile(type: JavaExec) {
    group rootProject.name

    classpath = sourceSets.main.runtimeClasspath
    mainClass.set(mainClassName)
    workingDir 'test'
    args 'decompile', '-debug'
}

task startClient(type: JavaExec) {
    group rootProject.name

    classpath = sourceSets.main.runtimeClasspath
    mainClass.set(mainClassName)
    workingDir 'test'
    args 'startclient', '-debug'
}

task startServer(type: JavaExec) {
    group rootProject.name

    classpath = sourceSets.main.runtimeClasspath
    mainClass.set(mainClassName)
    workingDir 'test'
    args 'startserver', '-debug'
}

task recompile(type: JavaExec) {
    group rootProject.name

    classpath = sourceSets.main.runtimeClasspath
    mainClass.set(mainClassName)
    workingDir 'test'
    args 'recompile', '-debug'
}

task reobfuscate(type: JavaExec) {
    group rootProject.name

    classpath = sourceSets.main.runtimeClasspath
    mainClass.set(mainClassName)
    workingDir 'test'
    args 'reobfuscate', '-debug'
}

task update_md5(type: JavaExec) {
    group rootProject.name

    classpath = sourceSets.main.runtimeClasspath
    mainClass.set(mainClassName)
    workingDir 'test'
    args 'updatemd5', '-debug'
}

task setup(type: JavaExec) {
    group = rootProject.name
    standardInput = System.in

    classpath = sourceSets.main.runtimeClasspath
    mainClass.set(mainClassName)
    workingDir 'test'
    args 'setup', '-debug'
}

task cleanup(type: JavaExec) {
    group = rootProject.name
    standardInput = System.in

    classpath = sourceSets.main.runtimeClasspath
    mainClass.set(mainClassName)
    workingDir 'test'
    args 'cleanup', '-debug'
}

task createpatch(type: JavaExec) {
    group = rootProject.name
    standardInput = System.in

    classpath = sourceSets.main.runtimeClasspath
    mainClass.set(mainClassName)
    workingDir 'test'
    args 'createpatch', '-debug'
}
